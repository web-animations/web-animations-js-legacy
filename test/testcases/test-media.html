<!--
Copyright 2013 Google Inc. All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!DOCTYPE html>
<style type="text/css">
video {
  width: 100px;
}
</style>

<!--
Videos taken from
http://techslides.com/sample-webm-ogg-and-mp4-video-files-for-html5

See comment for getNextVideo().
-->
<div id="videos">
  <video>
    <source src="small.webm" type="video/webm">
    <source src="small.mp4" type="video/mp4">
  </video>
</div>
  
<script src="../bootstrap.js"></script>
<script>
"use strict";

var dt = document.timeline;

// Most of these tests require the video to have loaded before they run.
// However, there seem to be bugs in the test harness which prevent async_test()
// from working properly with timing_test(). This means that we can't add the
// video dynamically then wait for it to load before testing. Instead, we
// include all videos in static HTML so they are loaded as part of the document,
// and start the test from an at() callback, which always runs after the
// document's load event has fired.
//
// TODO: Fix the test runner to allow the use of async_test() with
// timing_test(), which will allow the video elements to be created dynamically.
var videos = document.getElementById("videos").getElementsByTagName('video');
// Cache this length, as videos is a live NodeList.
var numStaticVideos = videos.length;
var nextIndex = 0;
function getNextVideo() {
  if (nextIndex >= numStaticVideos) {
    throw new Error('No more videos!');
  }
  return videos[nextIndex++];
}


// Test basic use.
timing_test(function() {
  var video = getNextVideo();
  dt.play(new MediaReference(video));
  at(0.0, function() {
    assert_equals(video.playbackRate,  1.0);
    // Why does this fail in runner, but not browser?
    assert_false(video.paused);
  });
}, "Basic use");

</script>
